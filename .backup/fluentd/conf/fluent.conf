<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<match **>
  @type opensearch
  host opensearch  # localhost → opensearch に変更
  port 9200
  scheme http
  logstash_format true
  logstash_prefix kubernetes
  include_tag_key true
  
  # バルクリクエストのサイズを制限
  bulk_message_request_threshold 10M
  
  <buffer tag, time>
    @type file
    path /fluentd/log/opensearch_buffer
    timekey 1d
    timekey_wait 10m
    flush_interval 5s
    # チャンクサイズを小さくする
    chunk_limit_size 5M
    # バッファの最大サイズを設定
    total_limit_size 512M
    retry_max_interval 30
    retry_max_times 5
    overflow_action drop_oldest_chunk
  </buffer>
</match>
