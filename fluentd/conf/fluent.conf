<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<match **>
  @type copy
  <store>
    @type stdout
  </store>
  <store>
    @type opensearch
    host opensearch
    port 9200
    scheme http
    ssl_verify false
    
    logstash_format true
    logstash_prefix kubernetes
    logstash_dateformat %Y.%m.%d
    include_timestamp true
    
    <buffer>
      @type file
      path /fluentd/buffer/kubernetes
      flush_mode interval
      flush_interval 10s
      flush_thread_count 2
      chunk_limit_size 5M
      queue_limit_length 32
      retry_max_interval 30
      retry_forever false
      retry_max_times 10
      overflow_action drop_oldest_chunk
    </buffer>
    
    <secondary>
      @type file
      path /fluentd/failed/kubernetes
    </secondary>
  </store>
</match>
